<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿè¯Šæ–­æ¨¡å¼</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
        .error-box { background: #fee; border: 1px solid #f00; padding: 15px; color: #c00; border-radius: 8px; word-break: break-all; }
        .success-box { background: #efe; border: 1px solid #0a0; padding: 15px; color: #060; border-radius: 8px; }
        button { padding: 10px 20px; font-size: 16px; background: #007bff; color: white; border: none; border-radius: 5px; margin-top: 20px; }
    </style>
</head>
<body>

    <h2>ğŸ› ï¸ ç³»ç»Ÿè¿æ¥è¯Šæ–­</h2>
    <p>æ­£åœ¨å°è¯•è¿æ¥ä½ çš„æ•°æ®åº“...</p>
    <div id="status">æ£€æµ‹ä¸­...</div>

    <script>
        // ==========================================
        // ğŸ”´ è¯·åœ¨è¿™é‡Œå¡«å…¥ä½ çš„ URL å’Œ KEY ğŸ”´
        const SUPABASE_URL = 'https://alprqqrwskvohnwjmefn.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFscHJxcXJ3c2t2b2hud2ptZWZuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5NDUzNTUsImV4cCI6MjA4MDUyMTM1NX0.F2XF0ABt4pqF7HTw2oRjhXrgxSNOnVYp1KiBy04nrRY';  // ğŸ‘ˆ å¿…å¡«ï¼ï¼è¦æŠŠ ey... å¼€å¤´çš„é•¿ä¸²å¡«è¿›æ¥ï¼
        // ==========================================

        const { createClient } = supabase;
        const _supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

        async function testConnection() {
            const statusDiv = document.getElementById('status');
            
            try {
                // 1. æ£€æŸ¥ Key æ˜¯å¦å¡«äº†
                if (!SUPABASE_KEY || SUPABASE_KEY.length < 10) {
                    statusDiv.innerHTML = `<div class="error-box">âŒ é”™è¯¯ï¼šä»£ç é‡Œçš„ SUPABASE_KEY æ˜¯ç©ºçš„ï¼<br>è¯·å» GitHub ç¼–è¾‘ index.html å¡«å…¥å¯†é’¥ã€‚</div>`;
                    return;
                }

                // 2. å°è¯•è¿æ¥æ•°æ®åº“
                const { data, error } = await _supabase.from('sermons').select('*').limit(1);

                if (error) {
                    // ğŸ”´ æ‰“å°è¯¦ç»†é”™è¯¯ä¿¡æ¯
                    statusDiv.innerHTML = `
                        <div class="error-box">
                            <strong>âŒ è¿æ¥å¤±è´¥ï¼</strong><br>
                            <strong>é”™è¯¯ä»£ç  (Code):</strong> ${error.code || 'æ— '}<br>
                            <strong>é”™è¯¯ä¿¡æ¯ (Message):</strong> ${error.message}<br>
                            <strong>å»ºè®®ï¼š</strong><br>
                            1. å¦‚æœæ˜¾ç¤º "relation not found"ï¼Œè¯´æ˜è¡¨åé”™äº†ï¼ˆå¿…é¡»å« sermonsï¼‰ã€‚<br>
                            2. å¦‚æœæ˜¾ç¤º "apikey invalid"ï¼Œè¯´æ˜å¯†é’¥å¡«é”™äº†ã€‚<br>
                            3. å¦‚æœæ˜¾ç¤º "fetch failed"ï¼Œè¯´æ˜ç½‘ç»œä¸é€šã€‚
                        </div>`;
                } else {
                    // ğŸŸ¢ æˆåŠŸ
                    statusDiv.innerHTML = `
                        <div class="success-box">
                            <strong>âœ… è¿æ¥æˆåŠŸï¼</strong><br>
                            è·å–åˆ°äº† ${data.length} æ¡æ•°æ®ã€‚<br>
                            å¦‚æœæ•°æ®æ˜¯ 0 æ¡ï¼Œè¯·å» Supabase æ’å…¥ä¸€æ¡æµ‹è¯•æ•°æ®ã€‚<br>
                            <br>
                            ç¬¬ä¸€æ¡æ•°æ®æ ‡é¢˜ï¼š${data.length > 0 ? data[0].title : 'æ— æ•°æ®'}
                        </div>`;
                }
            } catch (err) {
                statusDiv.innerHTML = `<div class="error-box">âŒ ç¨‹åºå´©æºƒï¼š${err.message}</div>`;
            }
        }

        testConnection();
    </script>
</body>
</html>
